<html> 
<head>    
<script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script type="text/javascript" src="//thingspeak.com/highcharts-3.0.8.js"></script>
<script type="text/javascript" src="//thingspeak.com/exporting.js"></script>


<style type="text/css"> 
body 
{ 
background-color: #ddd; 
font-family:verdana; 
} 

table, td, tr { 
text-align: center; 
font-size: 20; 
} 
</style> 

<script type='text/javascript' src='https://ajax.googleapis.com/ajax/libs/jquery/1.4.4/jquery.min.js'></script> 
<script type='text/javascript' src='https://www.google.com/jsapi'></script> 
<script type='text/javascript'> 

var chart1, chart2, chart3, chart4; 
var charts; 
var data1, data2, data3, data4; 

google.load('visualization', '1', {packages:['gauge']}); 
google.setOnLoadCallback(initChart); 

function displayData1(point1) { 
data1.setValue(0, 0, '°C'); 
data1.setValue(0, 1, point1); 
chart1.draw(data1, options1); 
} 
function displayData2(point2) { 
data2.setValue(0, 0, '%'); 
data2.setValue(0, 1, point2); 
chart2.draw(data2, options2); 
} 
function displayData3(point3) { 
data3.setValue(0, 0, 'hPa'); 
data3.setValue(0, 1, point3); 
chart3.draw(data3, options3); 
} 
function displayData4(point4) { 
data4.setValue(0, 0, '°C'); 
data4.setValue(0, 1, point4); 
chart4.draw(data4, options4); 
} 

function loadData() { 

// variable for the data point 
var p1, p2, p3, p4; 

$.getJSON('https://api.thingspeak.com/channels/82350/feed/last.json?key=F9GVWNCK6XMRKPMD&callback=?', function(data1) { 

// get the data point 
p1 = data1.field1; 

if (p1) 
{ 
p1 = Math.round(p1); 
displayData1(p1); 
} 


}); 
$.getJSON('https://api.thingspeak.com/channels/82350/feed/last.json?key=F9GVWNCK6XMRKPMD&callback=?', function(data2) { 

// get the data point 
p2 = data2.field2; 

if (p2) 
{ 
p2 = Math.round(p2); 
displayData2(p2); 
} 

}); 
$.getJSON('https://api.thingspeak.com/channels/82350/feed/last.json?key=F9GVWNCK6XMRKPMD&callback=?', function(data3) { 

// get the data point 
p3 = data3.field3; 

if (p3) 
{ 
p3 = Math.round(p3); 
displayData3(p3); 
} 
}); 
$.getJSON('https://api.thingspeak.com/channels/82350/feed/last.json?key=F9GVWNCK6XMRKPMD&callback=?', function(data4) { 

// get the data point 
p4 = data4.field4; 

if (p4) 
{ 
p4 = Math.round(p4); 
displayData4(p4); 
} 

}); 

} 

function initChart() { 

data1 = new google.visualization.DataTable(); 
data1.addColumn('string', 'Label'); 
data1.addColumn('number', 'Value'); 
data1.addRows(1); 
data2 = new google.visualization.DataTable(); 
data2.addColumn('string', 'Label'); 
data2.addColumn('number', 'Value'); 
data2.addRows(1); 
data3 = new google.visualization.DataTable(); 
data3.addColumn('string', 'Label'); 
data3.addColumn('number', 'Value'); 
data3.addRows(1); 
data4 = new google.visualization.DataTable(); 
data4.addColumn('string', 'Label'); 
data4.addColumn('number', 'Value'); 
data4.addRows(1); 
chart1 = new google.visualization.Gauge(document.getElementById('chart_div1')); 
options1 = {width: 200, height: 200, min: -10, max: 40, redFrom: 35, redTo: 40, yellowFrom:30, yellowTo: 35, greenFrom:20, greenTo:30, minorTicks: 5}; 

chart2 = new google.visualization.Gauge(document.getElementById('chart_div2')); 
options2 = {width: 200, height: 200, min: 0, max: 100, redFrom: 50, redTo: 100, yellowFrom:0, yellowTo: 30, greenFrom:30, greenTo:50, minorTicks: 5}; 

chart3 = new google.visualization.Gauge(document.getElementById('chart_div3')); 
options3 = {width: 200, height: 200, min: 900, max: 1100, redFrom: 900, redTo: 1005, greenFrom:1005, greenTo:1020, yellowFrom:1020, yellowTo: 1100, minorTicks: 5}; 

chart4 = new google.visualization.Gauge(document.getElementById('chart_div4')); 
options4 = {width: 200, height: 200, min: -10, max: 40, redFrom: 35, redTo: 40, yellowFrom:30, yellowTo: 35, greenFrom:20, greenTo:30, minorTicks: 5}; 

loadData(); 

setInterval('loadData()', 15000); 

} 

</script> 
<script type="text/javascript">
  // variables for the first series
  var series_1_channel_id = 82350;
  var series_1_field_number = 1;
  var series_1_read_api_key = '';
  var series_1_results = 30;
  var series_1_color = '#d62020';

  // variables for the second series
  var series_2_channel_id = 82350;
  var series_2_field_number = 2;
  var series_2_read_api_key = '';
  var series_2_results = 30;
  var series_2_color = '#00aaff';

  // chart title
  var chart_title = 'Humidity & Temperature';
  // y axis title
  var y_axis_title = 'Values';

  // user's timezone offset
  var my_offset = new Date().getTimezoneOffset();
  // chart variable
  var my_chart;

  // when the document is ready
  $(document).on('ready', function() {
    // add a blank chart
    addChart();
    // add the first series
    addSeries(series_1_channel_id, series_1_field_number, series_1_read_api_key, series_1_results, series_1_color);
    // add the second series
    addSeries(series_2_channel_id, series_2_field_number, series_2_read_api_key, series_2_results, series_2_color);
  });

  // add the base chart
  function addChart() {
    // variable for the local date in milliseconds
    var localDate;

    // specify the chart options
    var chartOptions = {
      chart: {
        renderTo: 'chart-container',
        defaultSeriesType: 'line',
        backgroundColor: '#ffffff',
        events: { }
      },
      title: { text: chart_title },
      plotOptions: {
        series: {
          marker: { radius: 3 },
          animation: true,
          step: false,
          borderWidth: 0,
          turboThreshold: 0
        }
      },
      tooltip: {
        // reformat the tooltips so that local times are displayed
        formatter: function() {
          var d = new Date(this.x + (my_offset*60000));
          var n = (this.point.name === undefined) ? '' : '<br>' + this.point.name;
          return this.series.name + ':<b>' + this.y + '</b>' + n + '<br>' + d.toDateString() + '<br>' + d.toTimeString().replace(/\(.*\)/, "");
        }
      },
      xAxis: {
        type: 'datetime',
        title: { text: 'Date' }
      },
      yAxis: { title: { text: y_axis_title } },
      exporting: { enabled: false },
      legend: { enabled: false },
      credits: {
        text: 'ThingSpeak.com',
        href: 'https://thingspeak.com/',
        style: { color: '#D62020' }
      }
    };

    // draw the chart
    my_chart = new Highcharts.Chart(chartOptions);
  }

  // add a series to the chart
  function addSeries(channel_id, field_number, api_key, results, color) {
    var field_name = 'field' + field_number;

    // get the data with a webservice call
    $.getJSON('https://api.thingspeak.com/channels/' + channel_id + '/fields/' + field_number + '.json?offset=0&round=2&results=' + results + '&api_key=' + api_key, function(data) {

      // blank array for holding chart data
      var chart_data = [];

      // iterate through each feed
      $.each(data.feeds, function() {
        var point = new Highcharts.Point();
        // set the proper values
        var value = this[field_name];
        point.x = getChartDate(this.created_at);
        point.y = parseFloat(value);
        // add location if possible
        if (this.location) { point.name = this.location; }
        // if a numerical value exists add it
        if (!isNaN(parseInt(value))) { chart_data.push(point); }
      });

      // add the chart data
      my_chart.addSeries({ data: chart_data, name: data.channel[field_name], color: color });
    });
  }

  // converts date format from JSON
  function getChartDate(d) {
    // offset in minutes is converted to milliseconds and subtracted so that chart's x-axis is correct
    return Date.parse(d) - (my_offset * 60000);
  }

</script>



</head> 

<body> 
<table> 
<tr> 
<td>Temp DHT22</td> 
<td> </td> 
<td><div id='chart_div1'></div></td> 
<td></td> 
</tr> 
<tr> 
<td>Humidity DHT22</td> 
<td> </td> <td><div id='chart_div2'></div></td> 
<td></td> 
</tr> 
<tr> 
<td>Pressure BMP180</td> 
<td> </td> <td><div id='chart_div3'></div></td> 
<td></td> 
</tr> 
<tr> 
<td>Temp BMP180</td> 
<td></td>
<td><div id='chart_div4'></div></td> 
<td></td>
</tr> 
<tr> 
  <div id="chart-container">
    <img alt="Ajax loader" src="//thingspeak.com/assets/loader-transparent.gif" style="position: absolute; margin: auto; top: 0; left: 0; right: 0; bottom: 0;" />
  </div>
</tr> 
</table> 
</body> 
</html>
